<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CoreBox 2.9</title>
  <style>
    :root {
      --primary: #00aa80;
      --secondary: #0088cc;
      --accent: #ff2255;
      --gold: #ffcc00;
      --dark: #081625;
      --darker: #050d18;
      --light: #d0e7ff;
      --panel-bg: rgba(8, 22, 41, 0.92);
      --plasma: #9d4edd;
      --slot-size: 64px;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: radial-gradient(circle at center, #050d18, #080c15);
      color: var(--light);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      padding: 10px;
      overflow-x: hidden;
      font-size: 13px;
    }
    
    .cyber-grid {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        linear-gradient(rgba(0, 120, 200, 0.06) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 120, 200, 0.06) 1px, transparent 1px);
      background-size: 30px 30px;
      z-index: -1;
      pointer-events: none;
    }
    
    .header {
      text-align: center;
      margin-bottom: 10px;
      width: 100%;
      max-width: 600px;
    }
    
    h1 {
      font-size: 1.8rem;
      margin: 0 0 5px;
      background: linear-gradient(to right, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: 0.5px;
      text-shadow: 0 0 8px rgba(0, 170, 255, 0.3);
    }
    
    .stats-container {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 8px 0;
      justify-content: center;
    }
    
    .stat-card {
      background: rgba(0, 20, 40, 0.7);
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid rgba(0, 120, 200, 0.4);
      min-width: 90px;
      text-align: center;
      font-size: 12px;
    }
    
    .stat-value {
      font-weight: bold;
      color: var(--primary);
      font-size: 1.1rem;
      margin-top: 3px;
    }
    
    .main {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-width: 600px;
      width: 100%;
    }
    
    .panel {
      background: var(--panel-bg);
      border-radius: 10px;
      padding: 12px;
      border: 1px solid rgba(0, 120, 200, 0.4);
      display: flex;
      flex-direction: column;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      transition: all 0.3s ease;
    }
    
    .panel.collapsed {
      padding: 8px 12px;
    }
    
    .panel-title {
      font-size: 1.1rem;
      margin-bottom: 10px;
      color: var(--secondary);
      text-align: center;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--primary);
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }
    
    .panel-title .collapse-icon {
      font-size: 14px;
      transition: transform 0.3s;
    }
    
    .panel.collapsed .panel-title .collapse-icon {
      transform: rotate(-90deg);
    }
    
    .panel-content {
      transition: all 0.3s ease;
      overflow: hidden;
    }
    
    .panel.collapsed .panel-content {
      height: 0;
      opacity: 0;
      margin: 0;
      padding: 0;
    }
    
    .inventory-grid {
      display: grid;
      grid-template-columns: repeat(6, var(--slot-size));
      gap: 8px;
      margin-bottom: 12px;
      justify-content: center;
    }
    
    .slot {
      background: linear-gradient(145deg, #0f2235, #0b1a2a);
      border: 1px solid rgba(0, 120, 200, 0.4);
      width: var(--slot-size);
      height: var(--slot-size);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      user-select: none;
      border-radius: 8px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
      transition: all 0.2s;
      font-size: 12px;
    }
    
    .slot:hover {
      transform: translateY(-2px);
      border-color: var(--secondary);
      box-shadow: 0 4px 8px rgba(0, 120, 200, 0.3);
    }
    
    .slot.critical {
      animation: glow 0.8s;
    }
    
    .slot.plasma {
      border-color: var(--plasma) !important;
      box-shadow: 0 0 10px var(--plasma);
    }
    
    .slot.empty {
      opacity: 0.6;
      background: rgba(15, 34, 53, 0.4);
    }
    
    @keyframes glow {
      0% { box-shadow: 0 0 3px #fff; }
      50% { box-shadow: 0 0 12px gold; }
      100% { box-shadow: 0 0 3px #fff; }
    }
    
    .item-name {
      font-weight: 600;
      margin-bottom: 1px;
      font-size: 10px;
      padding: 0 3px;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
      line-height: 1.1;
    }
    
    .item-count {
      font-size: 14px;
      font-weight: bold;
      color: var(--primary);
    }
    
    .action-buttons {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
      justify-content: center;
      margin-top: 5px;
    }
    
    .btn {
      padding: 8px 5px;
      background: linear-gradient(145deg, var(--primary), #009973);
      border: none;
      color: #000;
      font-weight: 700;
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.3s;
      font-size: 11px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      text-align: center;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 170, 153, 0.4);
    }
    
    .btn:active {
      transform: translateY(1px);
    }
    
    #logBox {
      background: rgba(6, 15, 28, 0.9);
      height: 100px;
      border-radius: 8px;
      padding: 10px;
      overflow-y: auto;
      font-size: 12px;
      border: 1px solid rgba(0, 120, 200, 0.3);
      margin-top: 10px;
      position: relative;
    }
    
    .log-entry {
      margin: 5px 0;
      padding: 3px 0;
      border-bottom: 1px dashed rgba(200, 220, 255, 0.1);
      line-height: 1.3;
    }
    
    .log-controls {
      display: flex;
      gap: 5px;
    }
    
    .log-btn {
      background: rgba(0, 120, 200, 0.3);
      border: 1px solid var(--secondary);
      color: var(--light);
      border-radius: 4px;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 11px;
      transition: all 0.2s;
    }
    
    .log-btn:hover {
      background: rgba(0, 140, 230, 0.4);
    }
    
    .upgrade-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 10px;
      margin-top: 8px;
    }
    
    .upgrade-card {
      background: linear-gradient(145deg, #142235, #0b1525);
      border-radius: 8px;
      padding: 10px;
      border: 1px solid rgba(0, 120, 200, 0.4);
    }
    
    .upgrade-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    
    .upgrade-title {
      font-weight: 700;
      color: var(--secondary);
      font-size: 12px;
    }
    
    .upgrade-level {
      background: rgba(0, 120, 200, 0.3);
      padding: 3px 8px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 12px;
    }
    
    .progress-container {
      width: 100%;
      height: 6px;
      background: #222;
      margin: 8px 0;
      border-radius: 3px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      border-radius: 3px;
    }
    
    .upgrade-cost {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
    }
    
    .upgrade-btn {
      background: linear-gradient(145deg, var(--primary), #009973);
      border: none;
      color: #000;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      transition: all 0.3s;
      min-width: 90px;
      font-size: 11px;
    }
    
    .upgrade-btn:disabled {
      background: #444;
      cursor: not-allowed;
      opacity: 0.6;
    }
    
    .upgrade-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 2px 6px rgba(0, 170, 153, 0.3);
    }
    
    .status-row {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    
    .status-item {
      flex: 1;
      background: rgba(0, 20, 40, 0.6);
      padding: 8px;
      border-radius: 8px;
      text-align: center;
      font-size: 12px;
    }
    
    .ai-status-item {
      flex: 1;
      background: rgba(0, 30, 60, 0.7);
      padding: 8px;
      border-radius: 8px;
      text-align: center;
      font-size: 12px;
      border: 1px solid rgba(0, 170, 255, 0.4);
      box-shadow: 0 0 8px rgba(0, 170, 255, 0.2);
    }
    
    .status-value {
      font-weight: bold;
      color: var(--primary);
      font-size: 1rem;
      margin-top: 3px;
    }
    
    .ai-status-value {
      font-weight: bold;
      color: var(--primary);
      font-size: 1.1rem;
      margin-top: 3px;
      text-shadow: 0 0 6px rgba(0, 200, 255, 0.5);
    }
    
    .quest-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 8px;
    }
    
    .quest-card {
      background: linear-gradient(145deg, #221550, #180a35);
      border-radius: 8px;
      padding: 10px;
      border: 1px solid rgba(0, 120, 200, 0.4);
    }
    
    .quest-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    
    .quest-title {
      font-weight: 700;
      color: var(--secondary);
      font-size: 12px;
    }
    
    .quest-reward {
      background: rgba(0, 120, 200, 0.3);
      padding: 3px 8px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 12px;
      color: gold;
    }
    
    .quest-description {
      font-size: 11px;
      margin-top: 6px;
      line-height: 1.3;
    }
    
    .mining-action {
      display: flex;
      justify-content: center;
      margin-bottom: 10px;
    }
    
    .tabs {
      display: flex;
      background: var(--panel-bg);
      border-radius: 8px 8px 0 0;
      overflow: hidden;
      margin-top: 15px;
      border: 1px solid rgba(0, 120, 200, 0.4);
      border-bottom: none;
    }
    
    .tab {
      flex: 1;
      padding: 10px;
      text-align: center;
      cursor: pointer;
      background: rgba(0, 20, 40, 0.6);
      transition: all 0.3s;
      font-weight: 600;
      border-right: 1px solid rgba(0, 120, 200, 0.4);
    }
    
    .tab:last-child {
      border-right: none;
    }
    
    .tab.active {
      background: rgba(0, 120, 200, 0.4);
      color: var(--light);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .trade-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 10px;
    }
    
    .trade-mode-toggle {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    
    .trade-mode-btn {
      padding: 8px 12px;
      background: rgba(0, 20, 40, 0.6);
      border: 1px solid var(--secondary);
      color: var(--light);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .trade-mode-btn.active {
      background: var(--secondary);
      color: white;
    }
    
    .trade-items-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }
    
    .trade-item {
      background: rgba(0, 20, 40, 0.6);
      border-radius: 6px;
      padding: 8px;
      border: 1px solid rgba(0, 120, 200, 0.4);
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .trade-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 120, 200, 0.3);
    }
    
    .trade-item-name {
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .trade-item-price {
      color: var(--primary);
      font-weight: bold;
    }
    
    .trade-item-amount {
      font-size: 11px;
      opacity: 0.8;
    }

    .radio-player {
      position: fixed;
      bottom: 10px;
      right: 10px;
      width: 120px;
      background: var(--panel-bg);
      border-radius: 6px;
      padding: 6px;
      border: 1px solid rgba(0, 120, 200, 0.4);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
      z-index: 100;
    }

    .radio-title {
      font-size: 10px;
      margin-bottom: 4px;
      color: var(--secondary);
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .radio-controls {
      display: flex;
      justify-content: center;
      gap: 6px;
      margin-bottom: 4px;
    }

    .radio-btn {
      background: var(--secondary);
      border: none;
      color: white;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 10px;
    }

    .radio-btn:hover {
      background: var(--primary);
      transform: scale(1.1);
    }

    .volume-control {
      width: 100%;
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 10px;
    }

    .volume-slider {
      flex: 1;
      -webkit-appearance: none;
      height: 3px;
      background: rgba(0, 120, 200, 0.4);
      border-radius: 2px;
      outline: none;
    }

    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 8px;
      height: 8px;
      background: var(--secondary);
      border-radius: 50%;
      cursor: pointer;
    }
    
    @media (max-width: 600px) {
      :root {
        --slot-size: 56px;
      }
      
      .inventory-grid {
        grid-template-columns: repeat(3, var(--slot-size));
      }
      
      .btn {
        min-width: 100%;
        font-size: 11px;
        padding: 6px 10px;
      }
      
      .action-buttons {
        grid-template-columns: 1fr;
      }
      
      h1 {
        font-size: 1.5rem;
      }
      
      .status-row {
        flex-direction: column;
        gap: 8px;
      }
      
      .log-controls {
        position: static;
        justify-content: center;
        margin-bottom: 5px;
      }
      
      .upgrade-btn {
        min-width: 100%;
        padding: 5px;
      }
      
      .upgrade-container {
        grid-template-columns: 1fr;
      }
      
      .stat-card {
        min-width: 80px;
        padding: 6px 8px;
      }
      
      .tab {
        font-size: 11px;
        padding: 8px 5px;
      }
      
      .trade-items-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .radio-player {
        width: 110px;
        right: 5px;
        bottom: 5px;
        padding: 5px;
      }
      
      .radio-controls {
        gap: 4px;
      }
      
      .radio-btn {
        width: 20px;
        height: 20px;
        font-size: 9px;
      }
    }
  </style>
</head>
<body>
  <div class="cyber-grid"></div>

  <div class="radio-player">
    <div class="radio-title">SpriteLayer Radio</div>
    <div class="radio-controls">
      <button id="playBtn" class="radio-btn">‚ñ∂</button>
      <button id="pauseBtn" class="radio-btn">‚è∏</button>
    </div>
    <div class="volume-control">
      <span>üîà</span>
      <input type="range" id="volumeSlider" class="volume-slider" min="0" max="1" step="0.1" value="0.5">
    </div>
  </div>

  <div class="header">
    <h1>CoreBox 2.9</h1>
    
    <div class="stats-container">
      <div class="stat-card">
        <div>–ë–∞–ª–∞–Ω—Å</div>
        <div id="currencyDisplay" class="stat-value">0‚Ç∏</div>
      </div>
      <div class="stat-card">
        <div>–í—Ä–µ–º—è</div>
        <div id="timeDisplay" class="stat-value">–î–µ–Ω—å ‚òÄÔ∏è</div>
      </div>
      <div class="stat-card">
        <div>–ó–∞—â–∏—Ç–∞</div>
        <div id="defenseDisplay" class="stat-value">0%</div>
      </div>
    </div>
  </div>

  <div class="main">
    <div class="panel">
      <div class="panel-title">
        <span>–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã</span>
        <span class="collapse-icon">‚ñº</span>
      </div>
      <div class="panel-content">
        <div class="status-row">
          <div class="status-item">
            <div>–¢–≠–¶</div>
            <div id="coalStatus" class="status-value">–í—ã–∫–ª</div>
          </div>
          <div class="ai-status-item">
            <div>–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç</div>
            <div id="aiStatusText" class="ai-status-value">–ê–∫—Ç–∏–≤–µ–Ω</div>
          </div>
          <div class="status-item">
            <div>–ü–æ–≤—Å—Ç–∞–Ω—Ü—ã</div>
            <div id="rebelStatus" class="status-value">–ù–∏–∑–∫–∏–π</div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="mining-action">
      <button id="mineBtn" class="btn pulse">–î–æ–±—ã—Ç—å —Ä–µ—Å—É—Ä—Å—ã <span id="miningBonus">+0%</span></button>
    </div>
    
    <div class="panel">
      <div class="panel-title">
        <span>–°–∏—Å—Ç–µ–º–Ω—ã–π –∂—É—Ä–Ω–∞–ª</span>
        <span class="collapse-icon">‚ñº</span>
      </div>
      <div class="panel-content">
        <div class="log-controls">
          <button id="clearLogBtn" class="log-btn">–û—á–∏—Å—Ç–∏—Ç—å</button>
          <button id="autoScrollBtn" class="log-btn">–ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª</button>
        </div>
        <div id="logBox"></div>
      </div>
    </div>
    
    <div class="tabs">
      <div class="tab active" data-tab="inventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
      <div class="tab" data-tab="upgrades">–ê–ø–≥—Ä–µ–π–¥—ã</div>
      <div class="tab" data-tab="trade">–¢–æ—Ä–≥–æ–≤–ª—è</div>
      <div class="tab" data-tab="quests">–ó–∞–¥–∞–Ω–∏—è</div>
    </div>
    
    <div class="tab-content active" id="inventory-tab">
      <div class="panel">
        <div class="panel-title">
          <span>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</span>
          <span class="collapse-icon">‚ñº</span>
        </div>
        <div class="panel-content">
          <div class="inventory-grid" id="inventory"></div>
        </div>
      </div>
    </div>
    
    <div class="tab-content" id="upgrades-tab">
      <div class="panel">
        <div class="panel-title">
          <span>–°–∏—Å—Ç–µ–º–Ω—ã–µ –∞–ø–≥—Ä–µ–π–¥—ã</span>
          <span class="collapse-icon">‚ñº</span>
        </div>
        <div class="panel-content">
          <div class="upgrade-container">
            <div class="upgrade-card">
              <div class="upgrade-header">
                <div class="upgrade-title">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–æ–±—ã—á–∏</div>
                <div class="upgrade-level">–£—Ä. <span id="miningLevel">0</span>/10</div>
              </div>
              <div class="progress-container">
                <div class="progress-fill" id="miningProgress" style="width: 0%"></div>
              </div>
              
              <div class="upgrade-requirements">
                <div class="requirement">
                  <div class="requirement-name">
                    <div class="requirement-icon">üéõÔ∏è</div>
                    <span>–ß–∏–ø—ã:</span>
                  </div>
                  <div class="requirement-value" id="miningChipsReq">0/5</div>
                </div>
              </div>
              
              <div class="upgrade-cost">
                <button id="upgradeMiningBtn" class="upgrade-btn">–£–ª—É—á—à–∏—Ç—å</button>
              </div>
            </div>
            
            <div class="upgrade-card">
              <div class="upgrade-header">
                <div class="upgrade-title">–¢—É—Ä—Ä–µ–ª–∏ –∑–∞—â–∏—Ç—ã</div>
                <div class="upgrade-level" id="defenseStatus">–ù–µ–∞–∫—Ç–∏–≤–Ω–æ</div>
              </div>
              <div class="progress-container">
                <div class="progress-fill" style="width: 0%"></div>
              </div>
              
              <div class="upgrade-requirements">
                <div class="requirement">
                  <div class="requirement-name">
                    <div class="requirement-icon">‚ö°</div>
                    <span>–ü–ª–∞–∑–º–∞:</span>
                  </div>
                  <div class="requirement-value" id="defensePlasmaReq">0/3</div>
                </div>
              </div>
              
              <div class="upgrade-cost">
                <button id="upgradeDefenseBtn" class="upgrade-btn">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
              </div>
            </div>
            
            <div class="upgrade-card">
              <div class="upgrade-header">
                <div class="upgrade-title">–£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –∑–∞—â–∏—Ç—ã</div>
                <div class="upgrade-level" id="defenseLevel">–£—Ä. 0/5</div>
              </div>
              <div class="progress-container">
                <div class="progress-fill" style="width: 0%"></div>
              </div>
              
              <div class="upgrade-requirements">
                <div class="requirement">
                  <div class="requirement-name">
                    <div class="requirement-icon">üéõÔ∏è</div>
                    <span>–ß–∏–ø—ã:</span>
                  </div>
                  <div class="requirement-value" id="defenseChipsReq">0/10</div>
                </div>
                <div class="requirement">
                  <div class="requirement-name">
                    <div class="requirement-icon">‚ö°</div>
                    <span>–ü–ª–∞–∑–º–∞:</span>
                  </div>
                  <div class="requirement-value" id="defensePlasmaLevelReq">0/1</div>
                </div>
              </div>
              
              <div class="upgrade-cost">
                <button id="upgradeDefenseLevelBtn" class="upgrade-btn">–£–ª—É—á—à–∏—Ç—å</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="tab-content" id="trade-tab">
      <div class="panel">
        <div class="panel-title">
          <span>–¢–æ—Ä–≥–æ–≤–ª—è</span>
          <span class="collapse-icon">‚ñº</span>
        </div>
        <div class="panel-content">
          <div class="trade-container">
            <div class="trade-mode-toggle">
              <button id="buyModeBtn" class="trade-mode-btn active">–ö—É–ø–∏—Ç—å</button>
              <button id="sellModeBtn" class="trade-mode-btn">–ü—Ä–æ–¥–∞—Ç—å</button>
            </div>
            
            <div id="buyItemsContainer" class="trade-items-grid">
              <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —Å–∫—Ä–∏–ø—Ç–æ–º -->
            </div>
            
            <div id="sellItemsContainer" class="trade-items-grid" style="display: none;">
              <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —Å–∫—Ä–∏–ø—Ç–æ–º -->
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="tab-content" id="quests-tab">
      <div class="panel">
        <div class="panel-title">
          <span>–ó–∞–¥–∞–Ω–∏—è</span>
          <span class="collapse-icon">‚ñº</span>
        </div>
        <div class="panel-content">
          <div class="quest-container" id="questsContainer"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–≥—Ä—ã
      const STORAGE_KEY = 'coreboxSave2.9';
      const maxSlots = 18;
      const CYCLE_DURATION = 45; // 45 —Å–µ–∫—É–Ω–¥ –Ω–∞ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª (–¥–µ–Ω—å+–Ω–æ—á—å)
      
      // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
      const inventory = { 
        '–ò–ò': 1, 
        '–£–≥–æ–ª—å': 0, 
        '–ú—É—Å–æ—Ä': 0,
        '–ß–∏–ø—ã': 0,
        '–ü–ª–∞–∑–º–∞': 0
      };
      
      const upgrades = {
        mining: 0,
        defense: false,
        defenseLevel: 0
      };
      
      let tng = 0;
      let coalEnabled = false;
      let gameTime = CYCLE_DURATION / 2; // –ù–∞—á–∏–Ω–∞–µ–º —Å –¥–Ω—è
      let isDay = true;
      let passiveCounter = 0;
      let trashSold = 0;
      let criticalMining = false;
      let autoScrollEnabled = true;
      let rebelActivity = 0;
      let lastUpdateTime = Date.now();
      let nightsSurvived = 0;
      let successfulDefenses = 0;
      let coalProduced = 0;
      let totalMined = 0;
      let aiDisabledUntil = 0;
      let nightsWithCoal = 0; // –°—á–µ—Ç—á–∏–∫ –Ω–æ—á–µ–π —Å –∞–∫—Ç–∏–≤–Ω–æ–π –¢–≠–¶
      
      // –°—é–∂–µ—Ç–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è
      const storyQuests = [
        {
          id: 'intro',
          title: '–ü–µ—Ä–≤—ã–µ —à–∞–≥–∏',
          description: '–î–æ–±—É–¥—å—Ç–µ –ª—é–±–æ–π —Ä–µ—Å—É—Ä—Å',
          type: 'mine_any',
          target: 1,
          reward: 10,
          completed: false
        },
        {
          id: 'power_up',
          title: '–ó–∞–ø—É—Å–∫ –¢–≠–¶',
          description: '–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ —É–≥–æ–ª—å–Ω—É—é –¢–≠–¶',
          type: 'activate_coal',
          target: 1,
          reward: 15,
          completed: false
        },
        {
          id: 'first_night',
          title: '–ü–µ—Ä–≤–∞—è –Ω–æ—á—å',
          description: '–ü–µ—Ä–µ–∂–∏–≤–∏—Ç–µ –Ω–æ—á—å —Å –∞–∫—Ç–∏–≤–Ω–æ–π –¢–≠–¶',
          type: 'survive_night',
          target: 1,
          reward: 20,
          completed: false
        },
        {
          id: 'mining_upgrade',
          title: '–£–ª—É—á—à–µ–Ω–∏–µ –¥–æ–±—ã—á–∏',
          description: '–£–ª—É—á—à–∏—Ç–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–æ–±—ã—á–∏ –¥–æ —É—Ä–æ–≤–Ω—è 1',
          type: 'upgrade_mining',
          target: 1,
          reward: 25,
          completed: false
        },
        {
          id: 'plasma_discovery',
          title: '–ò—Å—Ç–æ—á–Ω–∏–∫ —ç–Ω–µ—Ä–≥–∏–∏',
          description: '–î–æ–±—É–¥—å—Ç–µ 1 –ø–ª–∞–∑–º—É',
          type: 'mine_resource',
          resource: '–ü–ª–∞–∑–º–∞',
          target: 1,
          reward: 30,
          completed: false
        },
        {
          id: 'defense_activate',
          title: '–©–∏—Ç –∫–æ–º–ø–ª–µ–∫—Å–∞',
          description: '–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –∑–∞—â–∏—Ç—ã',
          type: 'activate_defense',
          target: 1,
          reward: 35,
          completed: false
        },
        {
          id: 'rebel_defense',
          title: '–û—Ç—Ä–∞–∑–∏—Ç–µ –∞—Ç–∞–∫—É',
          description: '–£—Å–ø–µ—à–Ω–æ –∑–∞—â–∏—Ç–∏—Ç–µ—Å—å –æ—Ç 2 –∞—Ç–∞–∫ –ø–æ–≤—Å—Ç–∞–Ω—Ü–µ–≤',
          type: 'defend_attacks',
          target: 2,
          reward: 50,
          completed: false
        },
        {
          id: 'core_restore',
          title: '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ CoreBox',
          description: '–ù–∞–∫–æ–ø–∏—Ç–µ 3 –ø–ª–∞–∑–º—ã –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —è–¥—Ä–∞',
          type: 'mine_resource',
          resource: '–ü–ª–∞–∑–º–∞',
          target: 3,
          reward: 100,
          completed: false
        }
      ];
      
      let currentQuestIndex = 0;
      
      // –¢–æ—Ä–≥–æ–≤—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã
      const tradeItems = {
        '–£–≥–æ–ª—å': { buyPrice: 5, sellPrice: 3 },
        '–ß–∏–ø—ã': { buyPrice: 15, sellPrice: 10 },
        '–ü–ª–∞–∑–º–∞': { buyPrice: 25, sellPrice: 15 }
      };
      
      // –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–≤–µ—Ä–Ω—É—Ç—ã—Ö –ø–∞–Ω–µ–ª–µ–π
      const collapsedState = {
        statusPanel: false,
        logPanel: false,
        inventoryPanel: false,
        upgradesPanel: false,
        tradePanel: false,
        questsPanel: false
      };
      
      // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
      const currencyDisplay = document.getElementById('currencyDisplay');
      const timeDisplay = document.getElementById('timeDisplay');
      const defenseDisplay = document.getElementById('defenseDisplay');
      const logBox = document.getElementById('logBox');
      const inventoryDiv = document.getElementById('inventory');
      const aiStatusText = document.getElementById('aiStatusText');
      const coalStatus = document.getElementById('coalStatus');
      const rebelStatus = document.getElementById('rebelStatus');
      const mineBtn = document.getElementById('mineBtn');
      const miningBonusSpan = document.getElementById('miningBonus');
      const miningLevel = document.getElementById('miningLevel');
      const miningProgress = document.getElementById('miningProgress');
      const upgradeMiningBtn = document.getElementById('upgradeMiningBtn');
      const defenseStatus = document.getElementById('defenseStatus');
      const upgradeDefenseBtn = document.getElementById('upgradeDefenseBtn');
      const defenseLevel = document.getElementById('defenseLevel');
      const upgradeDefenseLevelBtn = document.getElementById('upgradeDefenseLevelBtn');
      const miningChipsReq = document.getElementById('miningChipsReq');
      const defensePlasmaReq = document.getElementById('defensePlasmaReq');
      const defenseChipsReq = document.getElementById('defenseChipsReq');
      const defensePlasmaLevelReq = document.getElementById('defensePlasmaLevelReq');
      const clearLogBtn = document.getElementById('clearLogBtn');
      const autoScrollBtn = document.getElementById('autoScrollBtn');
      const questsContainer = document.getElementById('questsContainer');
      const buyItemsContainer = document.getElementById('buyItemsContainer');
      const sellItemsContainer = document.getElementById('sellItemsContainer');
      const buyModeBtn = document.getElementById('buyModeBtn');
      const sellModeBtn = document.getElementById('sellModeBtn');
      const tabs = document.querySelectorAll('.tab');
      const tabContents = document.querySelectorAll('.tab-content');
      const collapseButtons = document.querySelectorAll('.panel-title');

      // Radio Player Elements
      const playBtn = document.getElementById('playBtn');
      const pauseBtn = document.getElementById('pauseBtn');
      const volumeSlider = document.getElementById('volumeSlider');
      const audioPlayer = new Audio('https://spritelayerradio.com/listen/classic/classic.mp3');
      audioPlayer.loop = true;

      // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
      function log(message) {
        const entry = document.createElement('div');
        entry.className = 'log-entry';
        entry.textContent = `> ${message}`;
        logBox.appendChild(entry);
        
        if (autoScrollEnabled) {
          logBox.scrollTop = logBox.scrollHeight;
        }
      }
      
      function updateTimeDisplay() {
        const icon = isDay ? '‚òÄÔ∏è' : 'üåô';
        timeDisplay.textContent = `${isDay ? '–î–µ–Ω—å' : '–ù–æ—á—å'} ${icon} (${Math.ceil(gameTime)}s)`;
      }

      function updateCurrencyDisplay() {
        currencyDisplay.textContent = `${tng}‚Ç∏`;
      }
      
      function updateDefenseDisplay() {
        const defensePower = upgrades.defense ? 30 + (upgrades.defenseLevel * 15) : 0;
        defenseDisplay.textContent = `${defensePower}%`;
      }

      // –°–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
      function saveGame() {
        const saveData = {
          inventory,
          tng,
          coalEnabled,
          gameTime,
          isDay,
          passiveCounter,
          trashSold,
          upgrades,
          autoScrollEnabled,
          rebelActivity,
          lastUpdateTime: Date.now(),
          nightsSurvived,
          successfulDefenses,
          coalProduced,
          totalMined,
          aiDisabledUntil,
          nightsWithCoal,
          currentQuestIndex,
          storyQuests,
          collapsedState
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(saveData));
      }

      function loadGame() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
          try {
            const data = JSON.parse(saved);
            Object.keys(inventory).forEach(key => {
              if (data.inventory[key] !== undefined) inventory[key] = data.inventory[key];
            });
            tng = data.tng ?? 0;
            coalEnabled = data.coalEnabled ?? false;
            gameTime = data.gameTime ?? CYCLE_DURATION / 2;
            isDay = data.isDay ?? true;
            passiveCounter = data.passiveCounter ?? 0;
            trashSold = data.trashSold ?? 0;
            upgrades.mining = data.upgrades?.mining ?? 0;
            upgrades.defense = data.upgrades?.defense ?? false;
            upgrades.defenseLevel = data.upgrades?.defenseLevel ?? 0;
            autoScrollEnabled = data.autoScrollEnabled ?? true;
            rebelActivity = data.rebelActivity ?? 0;
            lastUpdateTime = data.lastUpdateTime ?? Date.now();
            nightsSurvived = data.nightsSurvived ?? 0;
            successfulDefenses = data.successfulDefenses ?? 0;
            coalProduced = data.coalProduced ?? 0;
            totalMined = data.totalMined ?? 0;
            aiDisabledUntil = data.aiDisabledUntil ?? 0;
            nightsWithCoal = data.nightsWithCoal ?? 0;
            currentQuestIndex = data.currentQuestIndex ?? 0;
            
            if (data.storyQuests) {
              data.storyQuests.forEach((savedQuest, index) => {
                if (storyQuests[index]) {
                  storyQuests[index].completed = savedQuest.completed ?? false;
                }
              });
            }
            
            if (data.collapsedState) {
              Object.assign(collapsedState, data.collapsedState);
            }
          } catch (e) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', e);
          }
        }
      }

      function calculateTrashPrice() {
        const basePrice = 1;
        const priceDrop = Math.floor(trashSold / 5) * 0.05;
        return Math.max(basePrice - priceDrop, 0.3);
      }

      function showStoryMessage(questId) {
        const messages = {
          intro: "–°–∏—Å—Ç–µ–º–∞ –æ–∂–∏–≤–∞–µ—Ç! –ü–µ—Ä–≤—ã–µ —Ä–µ—Å—É—Ä—Å—ã –¥–æ–±—ã—Ç—ã. CoreBox –Ω–∞—á–∏–Ω–∞–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ.",
          power_up: "–¢–≠–¶ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞! –¢–µ–ø–µ—Ä—å –ò–ò –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∏ –Ω–æ—á—å—é. –ù–æ –ø–æ–º–Ω–∏—Ç–µ - –∫–∞–∂–¥—É—é –Ω–æ—á—å —Ç—Ä–µ–±—É–µ—Ç—Å—è —É–≥–æ–ª—å.",
          first_night: "–ü–µ—Ä–≤–∞—è –Ω–æ—á—å –ø–µ—Ä–µ–∂–∏—Ç–∞. –î–∞—Ç—á–∏–∫–∏ —Ñ–∏–∫—Å–∏—Ä—É—é—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–≤—Å—Ç–∞–Ω—Ü–µ–≤ –≤ –ø–µ—Ä–∏–º–µ—Ç—Ä–µ.",
          mining_upgrade: "–°–∏—Å—Ç–µ–º–∞ –¥–æ–±—ã—á–∏ —É–ª—É—á—à–µ–Ω–∞. –ê–Ω–∞–ª–∏–∑ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–Ω–æ–º–∞–ª–∏–∏ –≤ –ø–ª–∞–∑–º–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏—è—Ö.",
          plasma_discovery: "–ü–ª–∞–∑–º–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞! –≠—Ç–æ –∫–ª—é—á –∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é —è–¥—Ä–∞ CoreBox.",
          defense_activate: "–ó–∞—â–∏—Ç–Ω—ã–µ —Ç—É—Ä–µ–ª–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã. –¢–µ–ø–µ—Ä—å —É –ø–æ–≤—Å—Ç–∞–Ω—Ü–µ–≤ –±—É–¥–µ—Ç –º–µ–Ω—å—à–µ —à–∞–Ω—Å–æ–≤.",
          rebel_defense: "–ê—Ç–∞–∫–∏ –æ—Ç—Ä–∞–∂–µ–Ω—ã! –ü–æ–≤—Å—Ç–∞–Ω—Ü—ã –æ—Ç—Å—Ç—É–ø–∞—é—Ç. –û—Å—Ç–∞–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —è–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã.",
          core_restore: "CoreBox –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω! –ü–ª–∞–∑–º–µ–Ω–Ω–æ–µ —è–¥—Ä–æ –∑–∞–ø—É—â–µ–Ω–æ. –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!"
        };
        
        if (messages[questId]) {
          log(`üí¨ ${messages[questId]}`);
        }
      }
      
      function completeCurrentQuest() {
        if (currentQuestIndex >= storyQuests.length) return;
        
        const quest = storyQuests[currentQuestIndex];
        if (quest && !quest.completed) {
          quest.completed = true;
          tng += quest.reward;
          log(`‚úÖ –ó–∞–¥–∞–Ω–∏–µ "${quest.title}" –≤—ã–ø–æ–ª–Ω–µ–Ω–æ! +${quest.reward}‚Ç∏`);
          showStoryMessage(quest.id);
          
          // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∑–∞–¥–∞–Ω–∏—é
          currentQuestIndex++;
          saveGame();
          render();
        }
      }
      
      function checkQuestsProgress() {
        if (currentQuestIndex >= storyQuests.length) return;
        
        const quest = storyQuests[currentQuestIndex];
        if (!quest || quest.completed) return;
        
        let isCompleted = false;
        
        switch(quest.type) {
          case 'mine_any':
            isCompleted = totalMined >= quest.target;
            break;
            
          case 'activate_coal':
            isCompleted = coalEnabled;
            break;
            
          case 'survive_night':
            isCompleted = nightsWithCoal >= quest.target;
            break;
            
          case 'upgrade_mining':
            isCompleted = upgrades.mining >= quest.target;
            break;
            
          case 'mine_resource':
            isCompleted = inventory[quest.resource] >= quest.target;
            break;
            
          case 'activate_defense':
            isCompleted = upgrades.defense;
            break;
            
          case 'defend_attacks':
            isCompleted = successfulDefenses >= quest.target;
            break;
        }
        
        if (isCompleted) {
          completeCurrentQuest();
        }
      }

      function render() {
        // –û–±–Ω–æ–≤–ª—è–µ–º –±–æ–Ω—É—Å –¥–æ–±—ã—á–∏
        miningBonusSpan.textContent = `+${upgrades.mining}%`;
        miningLevel.textContent = upgrades.mining;
        miningProgress.style.width = `${upgrades.mining * 10}%`;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å—ã
        coalStatus.textContent = coalEnabled ? '–ê–∫—Ç–∏–≤–Ω–æ' : '–í—ã–∫–ª';
        coalStatus.style.color = coalEnabled ? '#00cc66' : '#ff3333';
        defenseStatus.textContent = upgrades.defense ? '–ê–∫—Ç–∏–≤–Ω–æ' : '–í—ã–∫–ª';
        defenseLevel.textContent = `–£—Ä. ${upgrades.defenseLevel}/5`;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–≤—Å—Ç–∞–Ω—Ü–µ–≤
        let rebelText = '–ù–∏–∑–∫–∏–π';
        let rebelColor = '#00cc66';
        if (rebelActivity > 2) {
          rebelText = '–í—ã—Å–æ–∫–∏–π';
          rebelColor = '#ff3333';
        } else if (rebelActivity > 0) {
          rebelText = '–°—Ä–µ–¥–Ω–∏–π';
          rebelColor = '#ffcc00';
        }
        rebelStatus.textContent = rebelText;
        rebelStatus.style.color = rebelColor;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ò–ò
        const aiActive = (isDay || coalEnabled) && Date.now() > aiDisabledUntil;
        aiStatusText.textContent = aiActive ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω';
        aiStatusText.style.color = aiActive ? '#00cc66' : '#ff3333';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∞–ª—é—Ç—É –∏ –∑–∞—â–∏—Ç—É
        updateCurrencyDisplay();
        updateDefenseDisplay();
        updateTimeDisplay();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –∞–ø–≥—Ä–µ–π–¥–æ–≤
        upgradeMiningBtn.disabled = upgrades.mining >= 10 || inventory['–ß–∏–ø—ã'] < 5;
        upgradeDefenseBtn.disabled = upgrades.defense || inventory['–ü–ª–∞–∑–º–∞'] < 3;
        upgradeDefenseLevelBtn.disabled = upgrades.defenseLevel >= 5 || 
          inventory['–ß–∏–ø—ã'] < (upgrades.defenseLevel + 1) * 10 || 
          inventory['–ü–ª–∞–∑–º–∞'] < 1;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
        miningChipsReq.textContent = `${inventory['–ß–∏–ø—ã']}/5`;
        miningChipsReq.className = inventory['–ß–∏–ø—ã'] >= 5 ? 
          'requirement-value requirement-met' : 'requirement-value requirement-not-met';
        
        defensePlasmaReq.textContent = `${inventory['–ü–ª–∞–∑–º–∞']}/3`;
        defensePlasmaReq.className = inventory['–ü–ª–∞–∑–º–∞'] >= 3 ? 
          'requirement-value requirement-met' : 'requirement-value requirement-not-met';
        
        defenseChipsReq.textContent = `${inventory['–ß–∏–ø—ã']}/${(upgrades.defenseLevel + 1) * 10}`;
        defenseChipsReq.className = inventory['–ß–∏–ø—ã'] >= (upgrades.defenseLevel + 1) * 10 ? 
          'requirement-value requirement-met' : 'requirement-value requirement-not-met';
        
        defensePlasmaLevelReq.textContent = `${inventory['–ü–ª–∞–∑–º–∞']}/1`;
        defensePlasmaLevelReq.className = inventory['–ü–ª–∞–∑–º–∞'] >= 1 ? 
          'requirement-value requirement-met' : 'requirement-value requirement-not-met';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –∞–≤—Ç–æ—Å–∫—Ä–æ–ª–ª–∞
        autoScrollBtn.textContent = autoScrollEnabled ? '–ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª ‚úì' : '–ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª';
        
        // –û—á–∏—â–∞–µ–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
        inventoryDiv.innerHTML = '';

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        Object.entries(inventory).forEach(([name, count]) => {
          if (name === '–ò–ò') return;
          
          const slot = document.createElement('div');
          slot.className = 'slot';
          if (name === '–ü–ª–∞–∑–º–∞') slot.classList.add('plasma');
          
          const nameDiv = document.createElement('div');
          nameDiv.className = 'item-name';
          nameDiv.textContent = name;
          
          const countDiv = document.createElement('div');
          countDiv.className = 'item-count';
          countDiv.textContent = `x${count}`;
          
          slot.appendChild(nameDiv);
          slot.appendChild(countDiv);

          // –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –¥–æ–±—ã—á–∏
          if (criticalMining && (name === '–£–≥–æ–ª—å' || name === '–ü–ª–∞–∑–º–∞')) {
            slot.classList.add('critical');
            criticalMining = false;
          }
          
          // –ë–æ–Ω—É—Å—ã –¥–æ–±—ã—á–∏
          if (name === '–£–≥–æ–ª—å' || name === '–ú—É—Å–æ—Ä') {
            const bonusDiv = document.createElement('div');
            bonusDiv.className = 'mining-bonus';
            const baseChance = name === '–£–≥–æ–ª—å' ? 3 : 1.5;
            const totalBonus = upgrades.mining + (coalEnabled ? (name === '–£–≥–æ–ª—å' ? 2 : 1) : 0);
            bonusDiv.textContent = `+${baseChance + totalBonus}%`;
            slot.appendChild(bonusDiv);
          }

          // –£–≥–æ–ª—å
          if (name === '–£–≥–æ–ª—å') {
            if (coalEnabled) {
              slot.style.borderColor = 'var(--primary)';
              slot.style.boxShadow = '0 0 8px var(--primary)';
            }
            
            slot.onclick = () => handleCoalInteraction();
          }
          // –ü–ª–∞–∑–º–∞ –¥–ª—è –∑–∞—â–∏—Ç—ã
          else if (name === '–ü–ª–∞–∑–º–∞' && count > 0) {
            slot.classList.add('defense');
          }

          inventoryDiv.appendChild(slot);
        });

        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö —Å–ª–æ—Ç–æ–≤
        while (inventoryDiv.children.length < maxSlots) {
          const slot = document.createElement('div');
          slot.className = 'slot empty';
          slot.innerHTML = '<div class="item-name">[–ü—É—Å—Ç–æ]</div><div class="item-count">+</div>';
          inventoryDiv.appendChild(slot);
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∑–∞–¥–∞–Ω–∏–π
        renderQuests();
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏
        renderTrade();
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–≤–µ—Ä–Ω—É—Ç–æ—Å—Ç–∏
        applyCollapsedState();
      }
      
      function renderQuests() {
        questsContainer.innerHTML = '';
        
        if (currentQuestIndex >= storyQuests.length) {
          questsContainer.innerHTML = `
            <div class="quest-card">
              <div class="quest-header">
                <div class="quest-title">–ú–∏—Å—Å–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞!</div>
              </div>
              <div class="quest-description">
                –í—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ —Ä–∞–±–æ—Ç—É CoreBox! –°–∏—Å—Ç–µ–º–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –≤ —à—Ç–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ.
              </div>
            </div>
          `;
          return;
        }
        
        const quest = storyQuests[currentQuestIndex];
        if (!quest) return;
        
        let progressText = '';
        let progressPercent = 0;
        
        switch(quest.type) {
          case 'mine_any':
            progressText = `–î–æ–±—ã—Ç–æ: ${totalMined}/${quest.target}`;
            progressPercent = Math.min(100, (totalMined / quest.target) * 100);
            break;
            
          case 'activate_coal':
            progressText = coalEnabled ? '–¢–≠–¶ –∞–∫—Ç–∏–≤–Ω–∞' : '–¢–≠–¶ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞';
            progressPercent = coalEnabled ? 100 : 0;
            break;
            
          case 'survive_night':
            progressText = `–ù–æ—á–µ–π: ${nightsWithCoal}/${quest.target}`;
            progressPercent = Math.min(100, (nightsWithCoal / quest.target) * 100);
            break;
            
          case 'upgrade_mining':
            progressText = `–£—Ä–æ–≤–µ–Ω—å: ${upgrades.mining}/${quest.target}`;
            progressPercent = Math.min(100, (upgrades.mining / quest.target) * 100);
            break;
            
          case 'mine_resource':
            progressText = `${quest.resource}: ${inventory[quest.resource] || 0}/${quest.target}`;
            progressPercent = Math.min(100, ((inventory[quest.resource] || 0) / quest.target) * 100);
            break;
            
          case 'activate_defense':
            progressText = upgrades.defense ? '–ó–∞—â–∏—Ç–∞ –∞–∫—Ç–∏–≤–Ω–∞' : '–ó–∞—â–∏—Ç–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞';
            progressPercent = upgrades.defense ? 100 : 0;
            break;
            
          case 'defend_attacks':
            progressText = `–ó–∞—â–∏—Ç: ${successfulDefenses}/${quest.target}`;
            progressPercent = Math.min(100, (successfulDefenses / quest.target) * 100);
            break;
        }
        
        const questCard = document.createElement('div');
        questCard.className = 'quest-card';
        questCard.innerHTML = `
          <div class="quest-header">
            <div class="quest-title">${quest.title}</div>
            <div class="quest-reward">${quest.reward}‚Ç∏</div>
          </div>
          ${progressPercent > 0 ? `
            <div class="progress-container">
              <div class="progress-fill" style="width: ${progressPercent}%"></div>
            </div>
          ` : ''}
          <div class="quest-description">
            ${quest.description}<br>
            ${progressText}
          </div>
        `;
        
        questsContainer.appendChild(questCard);
      }
      
      function renderTrade() {
        buyItemsContainer.innerHTML = '';
        sellItemsContainer.innerHTML = '';
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏
        Object.entries(tradeItems).forEach(([itemName, item]) => {
          const buyItemElement = document.createElement('div');
          buyItemElement.className = 'trade-item';
          buyItemElement.innerHTML = `
            <div class="trade-item-name">${itemName}</div>
            <div class="trade-item-price">${item.buyPrice}‚Ç∏</div>
            <div class="trade-item-amount">–í –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ: ${inventory[itemName] || 0}</div>
          `;
          
          buyItemElement.addEventListener('click', () => {
            const price = item.buyPrice;
            if (tng >= price) {
              tng -= price;
              inventory[itemName] = (inventory[itemName] || 0) + 1;
              
              log(`–ö—É–ø–ª–µ–Ω 1 ${itemName} –∑–∞ ${price}‚Ç∏`);
              updateCurrencyDisplay();
              saveGame();
              render();
              checkQuestsProgress();
            } else {
              log(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ ${itemName}`);
            }
          });
          
          buyItemsContainer.appendChild(buyItemElement);
        });
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏
        Object.entries(inventory).forEach(([itemName, count]) => {
          if (itemName === '–ò–ò' || count <= 0) return;
          
          const sellItemElement = document.createElement('div');
          sellItemElement.className = 'trade-item';
          
          let price;
          if (itemName === '–ú—É—Å–æ—Ä') {
            price = calculateTrashPrice().toFixed(2);
          } else {
            price = tradeItems[itemName]?.sellPrice || 1;
          }
          
          sellItemElement.innerHTML = `
            <div class="trade-item-name">${itemName}</div>
            <div class="trade-item-price">${price}‚Ç∏</div>
            <div class="trade-item-amount">${count} —à—Ç.</div>
          `;
          
          sellItemElement.addEventListener('click', () => {
            if (inventory[itemName] > 0) {
              inventory[itemName]--;
              tng += parseFloat(price);
              if (itemName === '–ú—É—Å–æ—Ä') trashSold++;
              
              log(`–ü—Ä–æ–¥–∞–Ω 1 ${itemName} –∑–∞ ${price}‚Ç∏`);
              updateCurrencyDisplay();
              saveGame();
              render();
              checkQuestsProgress();
            }
          });
          
          sellItemsContainer.appendChild(sellItemElement);
        });
      }
      
      function applyCollapsedState() {
        const panels = document.querySelectorAll('.panel');
        panels.forEach(panel => {
          const title = panel.querySelector('.panel-title span').textContent;
          
          if (title.includes('–°–æ—Å—Ç–æ—è–Ω–∏–µ') && collapsedState.statusPanel) {
            panel.classList.add('collapsed');
          } else if (title.includes('–∂—É—Ä–Ω–∞–ª') && collapsedState.logPanel) {
            panel.classList.add('collapsed');
          } else if (title.includes('–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å') && collapsedState.inventoryPanel) {
            panel.classList.add('collapsed');
          } else if (title.includes('–∞–ø–≥—Ä–µ–π–¥—ã') && collapsedState.upgradesPanel) {
            panel.classList.add('collapsed');
          } else if (title.includes('–¢–æ—Ä–≥–æ–≤–ª—è') && collapsedState.tradePanel) {
            panel.classList.add('collapsed');
          } else if (title.includes('–ó–∞–¥–∞–Ω–∏—è') && collapsedState.questsPanel) {
            panel.classList.add('collapsed');
          }
        });
      }
      
      function handleRebelAttack() {
        const threatLevel = Math.min(1, rebelActivity * 0.2);
        
        if (Math.random() < threatLevel) {
          const attackType = Math.floor(Math.random() * 5);
          let message = "üåô –ü–æ–≤—Å—Ç–∞–Ω—Ü—ã –∞—Ç–∞–∫–æ–≤–∞–ª–∏!";
          let severeAttack = false;
          
          switch(attackType) {
            case 0: // –ö—Ä–∞–∂–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
              const resources = Object.keys(inventory).filter(k => k !== '–ò–ò' && inventory[k] > 0);
              if (resources.length > 0) {
                const stolenResource = resources[Math.floor(Math.random() * resources.length)];
                const amount = Math.min(inventory[stolenResource], Math.floor(Math.random() * 3) + 1);
                inventory[stolenResource] -= amount;
                message += ` –£–∫—Ä–∞–¥–µ–Ω–æ ${amount} ${stolenResource}`;
              }
              break;
              
            case 1: // –ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
              if (upgrades.mining > 0 && Math.random() < 0.3) {
                upgrades.mining--;
                message += " –ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –¥–æ–±—ã—á–∏! –£—Ä–æ–≤–µ–Ω—å –ø–æ–Ω–∏–∂–µ–Ω";
                severeAttack = true;
              }
              break;
              
            case 2: // –í–∞–Ω–¥–∞–ª–∏–∑–º
              if (inventory['–ú—É—Å–æ—Ä'] > 0) {
                const destroyed = Math.min(inventory['–ú—É—Å–æ—Ä'], Math.floor(Math.random() * 5) + 3);
                inventory['–ú—É—Å–æ—Ä'] -= destroyed;
                message += ` –£–Ω–∏—á—Ç–æ–∂–µ–Ω–æ ${destroyed} –º—É—Å–æ—Ä–∞`;
              }
              break;
              
            case 3: // –ü–æ–ª–æ–º–∫–∞ —Ç—É—Ä–µ–ª–µ–π
              if (upgrades.defense && Math.random() < 0.2) {
                upgrades.defense = false;
                message += " –¢—É—Ä—Ä–µ–ª–∏ –∑–∞—â–∏—Ç—ã —Å–ª–æ–º–∞–Ω—ã!";
                severeAttack = true;
              }
              break;
              
            case 4: // –í–∑–ª–æ–º –ò–ò (—Ä–µ–¥–∫–∏–π)
              if (Math.random() < 0.1) {
                aiDisabledUntil = Date.now() + 300000; // 5 –º–∏–Ω—É—Ç
                message += " –í–∑–ª–æ–º –ò–ò! –°–∏—Å—Ç–µ–º–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞ 5 –º–∏–Ω—É—Ç";
                severeAttack = true;
              }
              break;
          }
          
          log(message);
          
          // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–≤—Å—Ç–∞–Ω—Ü–µ–≤
          rebelActivity += severeAttack ? 2 : 1;
          
          // –°–Ω–∏–∂–∞–µ–º —É—Ä–æ–≤–µ–Ω—å –∑–∞—â–∏—Ç—ã –ø–æ—Å–ª–µ —Å–µ—Ä—å–µ–∑–Ω—ã—Ö –∞—Ç–∞–∫
          if (severeAttack && upgrades.defenseLevel > 0 && Math.random() < 0.5) {
            upgrades.defenseLevel--;
            log("‚ö†Ô∏è –£—Ä–æ–≤–µ–Ω—å –∑–∞—â–∏—Ç—ã –ø–æ–Ω–∏–∂–µ–Ω –∏–∑-–∑–∞ –∞—Ç–∞–∫–∏ –ø–æ–≤—Å—Ç–∞–Ω—Ü–µ–≤");
          }
          
          saveGame();
        }
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
      function handleCoalInteraction() {
        if (coalEnabled) {
          coalEnabled = false;
          log('–£–≥–æ–ª—å–Ω–∞—è –¢–≠–¶ –æ—Ç–∫–ª—é—á–µ–Ω–∞');
        } else {
          if (inventory['–£–≥–æ–ª—å'] > 0) {
            inventory['–£–≥–æ–ª—å']--;
            coalEnabled = true;
            log('–£–≥–æ–ª—å–Ω–∞—è –¢–≠–¶ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ (-1 —É–≥–æ–ª—å)');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏—è –Ω–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏—é –¢–≠–¶
            if (currentQuestIndex < storyQuests.length && 
                storyQuests[currentQuestIndex].type === 'activate_coal') {
              checkQuestsProgress();
            }
          } else {
            log('–ù–µ—Ç —É–≥–ª—è –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏!');
          }
        }
        saveGame();
        render();
      }
      
      function mineResources() {
        const aiActive = (isDay || coalEnabled) && Date.now() > aiDisabledUntil;
        if (!aiActive) {
          log('‚ùå –ò–ò –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω! –ù—É–∂–Ω–∞ —ç–Ω–µ—Ä–≥–∏—è');
          return;
        }
        
        let coalChance = 0.02 + (coalEnabled ? 0.02 : 0) + (upgrades.mining * 0.01);
        let trashChance = 0.01 + (coalEnabled ? 0.01 : 0) + (upgrades.mining * 0.01);
        let chipChance = 0.005;
        let plasmaChance = 0.003;
        const isCritical = Math.random() < 0.05;

        let foundSomething = false;

        if (Math.random() < coalChance) {
          const amount = isCritical ? 2 : 1;
          inventory['–£–≥–æ–ª—å'] += amount;
          criticalMining = isCritical;
          
          log(`–ù–∞–π–¥–µ–Ω${amount > 1 ? '–æ' : ''} ${amount} —É–≥–ª—è ü™®${isCritical ? ' ‚ú®' : ''}`);
          foundSomething = true;
          totalMined += amount;
        }
        
        if (Math.random() < trashChance) {
          inventory['–ú—É—Å–æ—Ä']++;
          log('–ù–∞–π–¥–µ–Ω –º—É—Å–æ—Ä ‚ôªÔ∏è');
          foundSomething = true;
          totalMined++;
        }
        
        if (Math.random() < chipChance) {
          inventory['–ß–∏–ø—ã']++;
          criticalMining = true;
          log('–ù–∞–π–¥–µ–Ω —á–∏–ø üéõÔ∏è‚ú®');
          foundSomething = true;
          totalMined++;
        }
        
        if (Math.random() < plasmaChance) {
          inventory['–ü–ª–∞–∑–º–∞']++;
          criticalMining = true;
          log('–ù–∞–π–¥–µ–Ω–∞ –ø–ª–∞–∑–º–∞ ‚ö°‚ú®');
          foundSomething = true;
          totalMined++;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏–π –Ω–∞ –¥–æ–±—ã—á—É
        if (foundSomething && currentQuestIndex < storyQuests.length) {
          checkQuestsProgress();
        }
        
        saveGame();
        render();
      }
      
      function upgradeMining() {
        if (upgrades.mining < 10 && inventory['–ß–∏–ø—ã'] >= 5) {
          inventory['–ß–∏–ø—ã'] -= 5;
          upgrades.mining++;
          
          log(`–£–ª—É—á—à–µ–Ω–∞ –¥–æ–±—ã—á–∞! –¢–µ–ø–µ—Ä—å +${upgrades.mining}% –∫ —à–∞–Ω—Å–∞–º`);
          
          // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏—è –Ω–∞ –∞–ø–≥—Ä–µ–π–¥
          if (currentQuestIndex < storyQuests.length && 
              storyQuests[currentQuestIndex].type === 'upgrade_mining') {
            checkQuestsProgress();
          }
          
          saveGame();
          render();
        }
      }
      
      function activateDefense() {
        if (!upgrades.defense && inventory['–ü–ª–∞–∑–º–∞'] >= 3) {
          inventory['–ü–ª–∞–∑–º–∞'] -= 3;
          upgrades.defense = true;
          
          log('–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã —Ç—É—Ä—Ä–µ–ª–∏ –∑–∞—â–∏—Ç—ã! (-3 –ø–ª–∞–∑–º—ã)');
          
          // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏—è –Ω–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏—é –∑–∞—â–∏—Ç—ã
          if (currentQuestIndex < storyQuests.length && 
              storyQuests[currentQuestIndex].type === 'activate_defense') {
            checkQuestsProgress();
          }
          
          saveGame();
          render();
        }
      }
      
      function upgradeDefense() {
        if (upgrades.defenseLevel < 5 && 
            inventory['–ß–∏–ø—ã'] >= (upgrades.defenseLevel + 1) * 10 && 
            inventory['–ü–ª–∞–∑–º–∞'] >= 1) {
          const chipsCost = (upgrades.defenseLevel + 1) * 10;
          inventory['–ß–∏–ø—ã'] -= chipsCost;
          inventory['–ü–ª–∞–∑–º–∞'] -= 1;
          upgrades.defenseLevel++;
          
          log(`–£–ª—É—á—à–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –¥–æ —É—Ä–æ–≤–Ω—è ${upgrades.defenseLevel}! (-${chipsCost} —á–∏–ø–æ–≤ –∏ -1 –ø–ª–∞–∑–º—ã)`);
          saveGame();
          render();
        }
      }
      
      function clearLog() {
        logBox.innerHTML = '';
        log('–ñ—É—Ä–Ω–∞–ª –æ—á–∏—â–µ–Ω');
      }
      
      function toggleAutoScroll() {
        autoScrollEnabled = !autoScrollEnabled;
        if (autoScrollEnabled) {
          logBox.scrollTop = logBox.scrollHeight;
        }
        saveGame();
        render();
      }
      
      function toggleCollapse(panel) {
        const title = panel.querySelector('.panel-title span').textContent;
        
        if (title.includes('–°–æ—Å—Ç–æ—è–Ω–∏–µ')) {
          collapsedState.statusPanel = !collapsedState.statusPanel;
        } else if (title.includes('–∂—É—Ä–Ω–∞–ª')) {
          collapsedState.logPanel = !collapsedState.logPanel;
        } else if (title.includes('–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å')) {
          collapsedState.inventoryPanel = !collapsedState.inventoryPanel;
        } else if (title.includes('–∞–ø–≥—Ä–µ–π–¥—ã')) {
          collapsedState.upgradesPanel = !collapsedState.upgradesPanel;
        } else if (title.includes('–¢–æ—Ä–≥–æ–≤–ª—è')) {
          collapsedState.tradePanel = !collapsedState.tradePanel;
        } else if (title.includes('–ó–∞–¥–∞–Ω–∏—è')) {
          collapsedState.questsPanel = !collapsedState.questsPanel;
        }
        
        panel.classList.toggle('collapsed');
        saveGame();
      }
      
      function switchTab(tabName) {
        tabContents.forEach(content => {
          content.classList.remove('active');
        });
        
        tabs.forEach(tab => {
          tab.classList.remove('active');
        });
        
        document.getElementById(`${tabName}-tab`).classList.add('active');
        document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
      }
      
      function toggleBuySellMode(isBuyMode) {
        buyModeBtn.classList.toggle('active', isBuyMode);
        sellModeBtn.classList.toggle('active', !isBuyMode);
        buyItemsContainer.style.display = isBuyMode ? 'grid' : 'none';
        sellItemsContainer.style.display = isBuyMode ? 'none' : 'grid';
      }

      function setupRadioPlayer() {
        playBtn.addEventListener('click', () => {
          audioPlayer.play();
          log('–†–∞–¥–∏–æ –≤–∫–ª—é—á–µ–Ω–æ');
        });
        
        pauseBtn.addEventListener('click', () => {
          audioPlayer.pause();
          log('–†–∞–¥–∏–æ –≤—ã–∫–ª—é—á–µ–Ω–æ');
        });
        
        volumeSlider.addEventListener('input', (e) => {
          audioPlayer.volume = e.target.value;
        });
        
        audioPlayer.volume = volumeSlider.value;
      }

      // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
      function gameLoop() {
        const now = Date.now();
        const secondsPassed = Math.floor((now - lastUpdateTime) / 1000);
        lastUpdateTime = now;
        
        gameTime -= secondsPassed;
        
        while (gameTime <= 0) {
          gameTime += CYCLE_DURATION;
          const wasNight = !isDay;
          isDay = !isDay;
          
          if (wasNight) {
            nightsSurvived++;
            
            if (coalEnabled) {
              nightsWithCoal++;
              
              if (inventory['–£–≥–æ–ª—å'] > 0) {
                inventory['–£–≥–æ–ª—å']--;
                log('üåô –ù–æ—á—å - —Å–≥–æ—Ä–µ–ª 1 —É–≥–æ–ª—å');
              } else {
                coalEnabled = false;
                log('üåô –ù–æ—á—å - —É–≥–æ–ª—å –∑–∞–∫–æ–Ω—á–∏–ª—Å—è, –¢–≠–¶ –æ—Ç–∫–ª—é—á–µ–Ω–∞');
              }
            }
            
            // –ê—Ç–∞–∫–∞ –ø–æ–≤—Å—Ç–∞–Ω—Ü–µ–≤
            const defensePower = upgrades.defense ? 30 + (upgrades.defenseLevel * 15) : 0;
            if (Math.random() * 100 > defensePower) {
              handleRebelAttack();
            } else if (upgrades.defense) {
              log('üåô –°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã –æ—Ç—Ä–∞–∑–∏–ª–∞ –∞—Ç–∞–∫—É –ø–æ–≤—Å—Ç–∞–Ω—Ü–µ–≤');
              successfulDefenses++;
            }
            
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–≤—Å—Ç–∞–Ω—Ü–µ–≤ –Ω–æ—á—å—é
            if (Math.random() < 0.3) {
              rebelActivity++;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏–π, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –Ω–æ—á—å—é
            checkQuestsProgress();
          } else {
            // –î–µ–Ω—å - —Å–Ω–∏–∂–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–≤—Å—Ç–∞–Ω—Ü–µ–≤
            rebelActivity = Math.max(0, rebelActivity - 1);
          }
          
          log(isDay ? '‚òÄÔ∏è –ù–∞—Å—Ç—É–ø–∏–ª –¥–µ–Ω—å' : 'üåô –ù–∞—Å—Ç—É–ø–∏–ª–∞ –Ω–æ—á—å');
          saveGame();
        }

        // –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥
        passiveCounter += secondsPassed;
        while (passiveCounter >= 10) {
          passiveCounter -= 10;
          const aiActive = (isDay || coalEnabled) && Date.now() > aiDisabledUntil;
          if (aiActive) {
            const coalChance = 0.003 + (upgrades.mining * 0.001);
            const trashChance = 0.007 + (upgrades.mining * 0.001);
            const chipChance = 0.001;
            const plasmaChance = 0.0005;
            
            if (Math.random() < coalChance) {
              inventory['–£–≥–æ–ª—å']++;
              totalMined++;
            }
            if (Math.random() < trashChance) {
              inventory['–ú—É—Å–æ—Ä']++;
              totalMined++;
            }
            if (Math.random() < chipChance) {
              inventory['–ß–∏–ø—ã']++;
              totalMined++;
            }
            if (Math.random() < plasmaChance) {
              inventory['–ü–ª–∞–∑–º–∞']++;
              totalMined++;
            }
            
            saveGame();
            checkQuestsProgress();
          }
        }

        render();
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
      function initEventListeners() {
        mineBtn.addEventListener('click', mineResources);
        upgradeMiningBtn.addEventListener('click', upgradeMining);
        upgradeDefenseBtn.addEventListener('click', activateDefense);
        upgradeDefenseLevelBtn.addEventListener('click', upgradeDefense);
        clearLogBtn.addEventListener('click', clearLog);
        autoScrollBtn.addEventListener('click', toggleAutoScroll);
        buyModeBtn.addEventListener('click', () => toggleBuySellMode(true));
        sellModeBtn.addEventListener('click', () => toggleBuySellMode(false));
        
        document.querySelectorAll('.panel-title').forEach(title => {
          title.addEventListener('click', (e) => {
            if (e.target.classList.contains('collapse-icon')) return;
            toggleCollapse(title.closest('.panel'));
          });
        });
        
        tabs.forEach(tab => {
          tab.addEventListener('click', () => {
            switchTab(tab.dataset.tab);
          });
        });
      }

      function initGame() {
        loadGame();
        initEventListeners();
        setupRadioPlayer();
        
        render();
        toggleBuySellMode(true);
        
        setInterval(gameLoop, 1000);
        
        log('–°–∏—Å—Ç–µ–º–∞ CoreBox 2.9 –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
        log('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É –¥–æ–±—ã—á–∏ —Ä–µ—Å—É—Ä—Å–æ–≤!');
        log('–í–∞—à–∞ –∑–∞–¥–∞—á–∞ - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞–±–æ—Ç—É –∫–æ–º–ø–ª–µ–∫—Å–∞ –∏ –∑–∞—â–∏—Ç–∏—Ç—å –µ–≥–æ –æ—Ç –ø–æ–≤—Å—Ç–∞–Ω—Ü–µ–≤');
      }

      initGame();
    });
  </script>
</body>
</html>