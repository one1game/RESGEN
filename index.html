<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CoreBox 2.1</title>
  <style>
    body {
      font-family: 'Courier New', monospace;
      background: #111;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    .main {
      display: flex;
      flex-direction: row;
      gap: 10px;
    }
    .inventory {
      display: grid;
      grid-template-columns: repeat(3, 80px);
      gap: 6px;
      margin-bottom: 10px;
      border: 1px solid #444;
      padding: 6px;
      border-radius: 8px;
      position: relative;
    }
    .left-slots, .right-slots {
      display: grid;
      grid-template-columns: 1fr;
      gap: 6px;
    }
    .center-panel {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .slot, .special-slot {
      background: #222;
      border: 2px solid #888;
      width: 70px;
      height: 70px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      text-align: center;
      flex-direction: column;
      user-select: none;
      box-shadow: 0 0 4px #000;
      border-radius: 5px;
      cursor: pointer;
      position: relative;
      transition: all 0.2s;
    }
    .slot.sell-mode {
      border-color: red !important;
      color: red;
    }
    .slot.recycle-mode {
      border-color: #0ff !important;
      color: #0ff;
    }
    .slot.critical {
      animation: glow 0.5s;
    }
    @keyframes glow {
      0% { box-shadow: 0 0 5px #fff; }
      100% { box-shadow: 0 0 20px gold; }
    }
    .sell-label, .recycle-label {
      font-size: 10px;
      position: absolute;
      bottom: 3px;
      width: 100%;
      text-align: center;
      user-select: none;
      pointer-events: none;
    }
    .sell-label {
      color: red;
    }
    .recycle-label {
      color: #0ff;
    }
    .special-slot {
      background: #004;
      width: 160px;
      height: 40px;
      font-size: 12px;
      margin-bottom: 10px;
      cursor: default;
    }
    button {
      padding: 10px 20px;
      background: #0f0;
      border: none;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      margin: 5px;
      border-radius: 5px;
      transition: all 0.2s;
    }
    button:hover {
      background: #0c0;
    }
    #timeDisplay {
      margin: 10px;
      font-size: 14px;
    }
    #currencyDisplay {
      font-size: 18px;
      margin-bottom: 6px;
      color: #0f0;
      font-weight: bold;
    }
    #logBox {
      margin-top: 10px;
      width: 100%;
      max-width: 400px;
      height: 120px;
      background: #222;
      overflow-y: auto;
      font-size: 12px;
      padding: 5px;
      border-radius: 6px;
      border: 1px solid #444;
    }
    .upgrade {
      background: #330066;
      border-color: #9900ff;
    }
    .progress-bar {
      width: 100%;
      height: 5px;
      background: #333;
      margin-top: 3px;
      border-radius: 2px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: #0f0;
      width: 0%;
    }
    .mining-bonus {
      position: absolute;
      top: -20px;
      left: 0;
      width: 100%;
      text-align: center;
      font-size: 10px;
      color: #0f0;
      background: rgba(0,0,0,0.7);
      border-radius: 3px;
      padding: 2px;
    }
    .upgrade-container {
      position: absolute;
      top: -25px;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: center;
    }
    .upgrade-icon {
      width: 16px;
      height: 16px;
      background: #9900ff;
      border-radius: 50%;
      margin: 0 2px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
    }
  </style>
</head>
<body>
  <h1>CoreBox 2.1</h1>
  <div id="currencyDisplay">TNG: 0‚Ç∏</div>
  <div id="timeDisplay">‚è∞ –î–µ–Ω—å</div>
  <div class="main">
    <div class="left-slots" id="leftSlots"></div>
    <div class="center-panel">
      <div class="special-slot" id="aiSlot">ü§ñ –ò–ò –∞–∫—Ç–∏–≤–µ–Ω</div>
      <div class="inventory" id="inventory"></div>
      <button id="mineBtn">–î–æ–±—ã—Ç—å —Ä–µ—Å—É—Ä—Å—ã (+<span id="miningBonus">0</span>%)</button>
      <div>
        <button id="toggleTrade">–¢–æ—Ä–≥–æ–≤–ª—è</button>
        <button id="toggleRecycle">–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞</button>
      </div>
      <div id="logBox"></div>
    </div>
    <div class="right-slots" id="rightSlots"></div>
  </div>

  <script>
    const STORAGE_KEY = 'coreboxSave2';

    const inventory = { 
      '–ò–ò': 1, 
      '–£–≥–æ–ª—å': 0, 
      '–ú—É—Å–æ—Ä': 0,
      '–ß–∏–ø—ã': 0,
      '–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞': 0
    };
    
    const upgrades = {
      mining: 0,
      autoSell: false
    };
    
    let tng = 0;
    const maxSlots = 9;
    let coalEnabled = false;
    let gameTime = 15;
    let isDay = true;
    let passiveCounter = 0;
    let sellMode = false;
    let recycleMode = false;
    let trashSold = 0;
    let insuranceDays = 0;
    let criticalMining = false;

    const leftPanelItems = ['–¢–≠–¶', '', '', '', ''];
    const rightPanelItems = ['–ü–µ—Ä–µ—Ä–∞–±–æ—Ç—á–∏–∫', '', '', '', ''];

    function log(message) {
      const box = document.getElementById('logBox');
      box.innerHTML += `üü¢ ${message}<br>`;
      box.scrollTop = box.scrollHeight;
    }

    function updateTimeDisplay() {
      const icon = isDay ? 'üåû' : 'üåô';
      document.getElementById('timeDisplay').innerText = `${icon} ${isDay ? '–î–µ–Ω—å' : '–ù–æ—á—å'} ‚Äî ${gameTime}s`;
    }

    function updateCurrencyDisplay() {
      document.getElementById('currencyDisplay').innerText = `TNG: ${tng}‚Ç∏`;
    }

    function saveGame() {
      const saveData = {
        inventory,
        tng,
        coalEnabled,
        gameTime,
        isDay,
        passiveCounter,
        sellMode,
        recycleMode,
        trashSold,
        insuranceDays,
        upgrades
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(saveData));
    }

    function loadGame() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        try {
          const data = JSON.parse(saved);
          Object.keys(inventory).forEach(key => {
            if (data.inventory[key] !== undefined) inventory[key] = data.inventory[key];
          });
          tng = data.tng ?? 0;
          coalEnabled = data.coalEnabled ?? false;
          gameTime = data.gameTime ?? 15;
          isDay = data.isDay ?? true;
          passiveCounter = data.passiveCounter ?? 0;
          sellMode = data.sellMode ?? false;
          recycleMode = data.recycleMode ?? false;
          trashSold = data.trashSold ?? 0;
          insuranceDays = data.insuranceDays ?? 0;
          upgrades.mining = data.upgrades?.mining ?? 0;
          upgrades.autoSell = data.upgrades?.autoSell ?? false;
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', e);
        }
      }
    }

    function calculateTrashPrice() {
      const basePrice = 1;
      const priceDrop = Math.floor(trashSold / 5) * 0.05;
      return Math.max(basePrice - priceDrop, 0.3);
    }

    function render() {
      const invDiv = document.getElementById('inventory');
      const leftDiv = document.getElementById('leftSlots');
      const rightDiv = document.getElementById('rightSlots');
      const aiSlot = document.getElementById('aiSlot');
      const mineBtn = document.getElementById('mineBtn');

      // –û–±–Ω–æ–≤–ª—è–µ–º –±–æ–Ω—É—Å –¥–æ–±—ã—á–∏ –Ω–∞ –∫–Ω–æ–ø–∫–µ
      document.getElementById('miningBonus').textContent = upgrades.mining;

      invDiv.innerHTML = '';
      leftDiv.innerHTML = '';
      rightDiv.innerHTML = '';

      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
      Object.entries(inventory).forEach(([name, count]) => {
        if (name === '–ò–ò') return;
        
        const slot = document.createElement('div');
        slot.className = 'slot';
        if (criticalMining && (name === '–£–≥–æ–ª—å' || name === '–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞')) {
          slot.classList.add('critical');
          criticalMining = false;
        }
        
        slot.textContent = `${name} x${count}`;

        // –î–æ–±–∞–≤–ª—è–µ–º –±–æ–Ω—É—Å –¥–æ–±—ã—á–∏ –¥–ª—è —É–≥–ª—è –∏ –º—É—Å–æ—Ä–∞
        if (name === '–£–≥–æ–ª—å' || name === '–ú—É—Å–æ—Ä') {
          const bonusDiv = document.createElement('div');
          bonusDiv.className = 'mining-bonus';
          const baseChance = name === '–£–≥–æ–ª—å' ? 3 : 1.5;
          const totalBonus = upgrades.mining + (coalEnabled ? (name === '–£–≥–æ–ª—å' ? 2 : 1) : 0);
          bonusDiv.textContent = `+${baseChance + totalBonus}%`;
          slot.appendChild(bonusDiv);
        }

        if (sellMode && name === '–ú—É—Å–æ—Ä') {
          slot.classList.add('sell-mode');
          const sellLabel = document.createElement('div');
          sellLabel.className = 'sell-label';
          sellLabel.textContent = count > 0 ? `–ü—Ä–æ–¥–∞—Ç—å (${calculateTrashPrice().toFixed(1)}‚Ç∏)` : '–ù–µ—Ç –º—É—Å–æ—Ä–∞';
          slot.appendChild(sellLabel);
          
          slot.onclick = () => {
            if (inventory['–ú—É—Å–æ—Ä'] > 0) {
              const price = calculateTrashPrice();
              tng += Math.floor(inventory['–ú—É—Å–æ—Ä'] * price);
              trashSold += inventory['–ú—É—Å–æ—Ä'];
              log(`–ü—Ä–æ–¥–∞–Ω–æ ${inventory['–ú—É—Å–æ—Ä']} –º—É—Å–æ—Ä–∞ +${Math.floor(inventory['–ú—É—Å–æ—Ä'] * price)}‚Ç∏`);
              inventory['–ú—É—Å–æ—Ä'] = 0;
              updateCurrencyDisplay();
              saveGame();
              render();
            }
          };
        } 
        else if (recycleMode && name === '–ú—É—Å–æ—Ä') {
          slot.classList.add('recycle-mode');
          const recycleLabel = document.createElement('div');
          recycleLabel.className = 'recycle-label';
          recycleLabel.textContent = count >= 5 ? '5‚Üí1 —É–≥–æ–ª—å' : '–ù—É–∂–Ω–æ 5';
          slot.appendChild(recycleLabel);
          
          slot.onclick = () => {
            if (inventory['–ú—É—Å–æ—Ä'] >= 5) {
              inventory['–ú—É—Å–æ—Ä'] -= 5;
              inventory['–£–≥–æ–ª—å']++;
              log('–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–æ 5 –º—É—Å–æ—Ä–∞ ‚Üí 1 —É–≥–æ–ª—å');
              saveGame();
              render();
            }
          };
        }
        else if (name === '–£–≥–æ–ª—å') {
          if (coalEnabled) {
            slot.style.borderColor = 'gold';
            slot.style.boxShadow = '0 0 8px gold';
          }
          
          slot.onclick = () => {
            if (sellMode && isDay) {
              if (inventory['–£–≥–æ–ª—å'] > 0) {
                inventory['–£–≥–æ–ª—å']--;
                tng += 3;
                coalEnabled = false;
                log('–ü—Ä–æ–¥–∞–Ω–æ 1 —É–≥–æ–ª—å +3‚Ç∏ (–¢–≠–¶ –æ—Ç–∫–ª—é—á–µ–Ω–∞)');
                updateCurrencyDisplay();
                saveGame();
                render();
              }
            } 
            else if (!sellMode && !recycleMode) {
              if (!coalEnabled) {
                if (inventory['–£–≥–æ–ª—å'] > 0) {
                  coalEnabled = true;
                  inventory['–£–≥–æ–ª—å']--;
                  log('–£–≥–æ–ª—å–Ω–∞—è –¢–≠–¶ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ (-1 —É–≥–æ–ª—å)');
                } else {
                  log('–ù–µ—Ç —É–≥–ª—è –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏!');
                }
              } else {
                coalEnabled = false;
                log('–£–≥–æ–ª—å–Ω–∞—è –¢–≠–¶ –æ—Ç–∫–ª—é—á–µ–Ω–∞');
              }
              saveGame();
              render();
            }
          };
        }
        else if (name === '–ß–∏–ø—ã' && count > 0) {
          slot.classList.add('upgrade');
          slot.onclick = () => {
            if (upgrades.mining < 10 && inventory['–ß–∏–ø—ã'] >= 5) {
              inventory['–ß–∏–ø—ã'] -= 5;
              upgrades.mining++;
              log(`–ê–ø–≥—Ä–µ–π–¥ –¥–æ–±—ã—á–∏! –¢–µ–ø–µ—Ä—å +${upgrades.mining}% –∫ —à–∞–Ω—Å–∞–º`);
              saveGame();
              render();
            } else if (!upgrades.autoSell && inventory['–ß–∏–ø—ã'] >= 20) {
              inventory['–ß–∏–ø—ã'] -= 20;
              upgrades.autoSell = true;
              log('–ê–ø–≥—Ä–µ–π–¥: –∞–≤—Ç–æ-–ø—Ä–æ–¥–∞–∂–∞ –º—É—Å–æ—Ä–∞!');
              saveGame();
              render();
            }
          };
        }

        invDiv.appendChild(slot);
      });

      // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö —Å–ª–æ—Ç–æ–≤
      while (invDiv.children.length < maxSlots) {
        const slot = document.createElement('div');
        slot.className = 'slot';
        slot.textContent = '[–ø—É—Å—Ç–æ]';
        invDiv.appendChild(slot);
      }

      // –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å (–¢–≠–¶)
      leftPanelItems.forEach((name, index) => {
        const slot = document.createElement('div');
        slot.className = 'slot';
        if (index === 0) {
          slot.textContent = coalEnabled ? '–¢–≠–¶ üî•' : '–¢–≠–¶';
          if (coalEnabled) {
            slot.style.borderColor = 'gold';
            slot.style.boxShadow = '0 0 8px gold';
          }
        } else {
          slot.textContent = name || '[–ø—É—Å—Ç–æ]';
        }
        leftDiv.appendChild(slot);
      });

      // –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å (–ü–µ—Ä–µ—Ä–∞–±–æ—Ç—á–∏–∫ –∏ –∞–ø–≥—Ä–µ–π–¥—ã)
      rightPanelItems.forEach((name, index) => {
        const slot = document.createElement('div');
        slot.className = 'slot';
        if (index === 0) {
          slot.textContent = '–ü–µ—Ä–µ—Ä–∞–±–æ—Ç—á–∏–∫';
        } else if (index === 4) {
          slot.textContent = '–ê–ø–≥—Ä–µ–π–¥—ã';
          const progress = document.createElement('div');
          progress.className = 'progress-bar';
          const fill = document.createElement('div');
          fill.className = 'progress-fill';
          fill.style.width = `${upgrades.mining * 10}%`;
          progress.appendChild(fill);
          slot.appendChild(document.createTextNode(`–î–æ–±—ã—á–∞ +${upgrades.mining}%`));
          slot.appendChild(progress);
          if (upgrades.autoSell) {
            slot.appendChild(document.createTextNode('–ê–≤—Ç–æ-–ø—Ä–æ–¥–∞–∂–∞ ‚úÖ'));
          }
          
          // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞–ø–≥—Ä–µ–π–¥–æ–≤
          const upgradeContainer = document.createElement('div');
          upgradeContainer.className = 'upgrade-container';
          
          for (let i = 0; i < 10; i++) {
            const icon = document.createElement('div');
            icon.className = 'upgrade-icon';
            icon.textContent = i < upgrades.mining ? '‚úì' : '';
            upgradeContainer.appendChild(icon);
          }
          
          slot.appendChild(upgradeContainer);
        } else {
          slot.textContent = name || '[–ø—É—Å—Ç–æ]';
        }
        rightDiv.appendChild(slot);
      });

      // –°—Ç–∞—Ç—É—Å –ò–ò
      const aiActive = isDay || (coalEnabled && inventory['–£–≥–æ–ª—å'] > 0);
      aiSlot.textContent = aiActive ? 'ü§ñ –ò–ò –∞–∫—Ç–∏–≤–µ–Ω' : 'üõë –ò–ò –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω';
      aiSlot.style.color = aiActive ? 'lime' : 'red';
      
      if (insuranceDays > 0) {
        aiSlot.textContent += ` (–°—Ç—Ä–∞—Ö–æ–≤–∫–∞: ${insuranceDays}–¥)`;
      }

      updateTimeDisplay();
      updateCurrencyDisplay();
    }

    function mineResources() {
      const aiActive = isDay || (coalEnabled && inventory['–£–≥–æ–ª—å'] > 0);
      if (!aiActive) {
        log('‚ùå –ò–ò –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω! –ù—É–∂–Ω–∞ —ç–Ω–µ—Ä–≥–∏—è');
        return;
      }
      
      const coalChance = 0.03 + (coalEnabled ? 0.02 : 0) + (upgrades.mining * 0.01);
      const trashChance = 0.015 + (coalEnabled ? 0.01 : 0) + (upgrades.mining * 0.01);
      const chipChance = 0.01;
      const isCritical = Math.random() < 0.1;

      if (Math.random() < coalChance) {
        const amount = isCritical ? 2 : 1;
        inventory['–£–≥–æ–ª—å'] += amount;
        criticalMining = isCritical;
        log(`–ù–∞–π–¥–µ–Ω${amount > 1 ? '–æ' : ''} ${amount} —É–≥–ª—è ü™®${isCritical ? ' ‚ú®' : ''}`);
      }
      if (Math.random() < trashChance) {
        inventory['–ú—É—Å–æ—Ä']++;
        log('–ù–∞–π–¥–µ–Ω –º—É—Å–æ—Ä ‚ôªÔ∏è');
      }
      if (Math.random() < chipChance) {
        inventory['–ß–∏–ø—ã']++;
        criticalMining = true;
        log('–ù–∞–π–¥–µ–Ω —á–∏–ø üéõÔ∏è‚ú®');
      }
      if (isCritical && Math.random() < 0.3) {
        inventory['–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞']++;
        log('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–±—ã—á–∞: –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ üíæ‚ú®');
      }
      
      if (upgrades.autoSell && inventory['–ú—É—Å–æ—Ä'] > 0) {
        const price = calculateTrashPrice() * 0.5;
        tng += Math.floor(inventory['–ú—É—Å–æ—Ä'] * price);
        trashSold += inventory['–ú—É—Å–æ—Ä'];
        log(`–ê–≤—Ç–æ-–ø—Ä–æ–¥–∞–∂–∞: ${inventory['–ú—É—Å–æ—Ä']} –º—É—Å–æ—Ä–∞ +${Math.floor(inventory['–ú—É—Å–æ—Ä'] * price)}‚Ç∏`);
        inventory['–ú—É—Å–æ—Ä'] = 0;
        updateCurrencyDisplay();
      }
      
      saveGame();
      render();
    }

    document.getElementById('mineBtn').addEventListener('click', mineResources);

    document.getElementById('toggleTrade').addEventListener('click', () => {
      sellMode = !sellMode;
      if (sellMode) recycleMode = false;
      log(sellMode ? '–†–µ–∂–∏–º —Ç–æ—Ä–≥–æ–≤–ª–∏ –≤–∫–ª—é—á—ë–Ω' : '–†–µ–∂–∏–º —Ç–æ—Ä–≥–æ–≤–ª–∏ –≤—ã–∫–ª—é—á–µ–Ω');
      saveGame();
      render();
    });

    document.getElementById('toggleRecycle').addEventListener('click', () => {
      recycleMode = !recycleMode;
      if (recycleMode) sellMode = false;
      log(recycleMode ? '–†–µ–∂–∏–º –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ –≤–∫–ª—é—á—ë–Ω' : '–†–µ–∂–∏–º –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ –≤—ã–∫–ª—é—á–µ–Ω');
      saveGame();
      render();
    });

    // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
    setInterval(() => {
      gameTime--;
      if (gameTime <= 0) {
        gameTime = 15;
        isDay = !isDay;
        
        if (!isDay) {
          if (coalEnabled) {
            if (inventory['–£–≥–æ–ª—å'] > 0) {
              inventory['–£–≥–æ–ª—å']--;
              log('üåô –ù–æ—á—å - —Å–≥–æ—Ä–µ–ª 1 —É–≥–æ–ª—å');
            } else {
              coalEnabled = false;
              log('üåô –ù–æ—á—å - —É–≥–æ–ª—å –∑–∞–∫–æ–Ω—á–∏–ª—Å—è, –¢–≠–¶ –æ—Ç–∫–ª—é—á–µ–Ω–∞');
            }
          }
          
          if (!coalEnabled && !isDay && insuranceDays === 0 && Math.random() < 0.2) {
            const items = Object.keys(inventory).filter(k => k !== '–ò–ò' && inventory[k] > 0);
            if (items.length > 0) {
              const stolenItem = items[Math.floor(Math.random() * items.length)];
              inventory[stolenItem]--;
              log(`üåô –í–æ—Ä—ã —É–∫—Ä–∞–ª–∏ 1 ${stolenItem}! –ö—É–ø–∏ —Å—Ç—Ä–∞—Ö–æ–≤–∫—É –¥–Ω—ë–º.`);
            }
          }
        } else {
          if (insuranceDays > 0) {
            insuranceDays--;
            if (insuranceDays === 0) {
              log('üåû –°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å');
            }
          }
          
          // –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏
          if (insuranceDays === 0 && tng >= 10 && Math.random() < 0.3) {
            log('–°—Ç—Ä–∞—Ö–æ–≤—â–∏–∫: "–ö—É–ø–∏ —Å—Ç—Ä–∞—Ö–æ–≤–∫—É –∑–∞ 10‚Ç∏ (3 –Ω–æ—á–∏)"');
          }
        }
        
        log(isDay ? 'üåû –ù–∞—Å—Ç—É–ø–∏–ª –¥–µ–Ω—å' : 'üåô –ù–∞—Å—Ç—É–ø–∏–ª–∞ –Ω–æ—á—å');
        saveGame();
      }

      // –ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥
      passiveCounter++;
      if (passiveCounter >= 10) {
        passiveCounter = 0;
        const aiActive = isDay || (coalEnabled && inventory['–£–≥–æ–ª—å'] > 0);
        if (aiActive) {
          const coalChance = 0.003 + (upgrades.mining * 0.001);
          const trashChance = 0.007 + (upgrades.mining * 0.001);
          
          if (Math.random() < coalChance) {
            inventory['–£–≥–æ–ª—å']++;
            log('–ü–∞—Å—Å–∏–≤–Ω–æ: —É–≥–æ–ª—å ü™®');
          }
          if (Math.random() < trashChance) {
            inventory['–ú—É—Å–æ—Ä']++;
            log('–ü–∞—Å—Å–∏–≤–Ω–æ: –º—É—Å–æ—Ä ‚ôªÔ∏è');
          }
          
          if (upgrades.autoSell && inventory['–ú—É—Å–æ—Ä'] > 0) {
            const price = calculateTrashPrice() * 0.5;
            tng += Math.floor(inventory['–ú—É—Å–æ—Ä'] * price);
            trashSold += inventory['–ú—É—Å–æ—Ä'];
            log(`–ê–≤—Ç–æ-–ø—Ä–æ–¥–∞–∂–∞: ${inventory['–ú—É—Å–æ—Ä']} –º—É—Å–æ—Ä–∞ +${Math.floor(inventory['–ú—É—Å–æ—Ä'] * price)}‚Ç∏`);
            inventory['–ú—É—Å–æ—Ä'] = 0;
            updateCurrencyDisplay();
          }
          
          saveGame();
        }
      }

      render();
    }, 1000);

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏
    document.addEventListener('keydown', (e) => {
      if (e.key === 'i' && isDay && tng >= 10) {
        tng -= 10;
        insuranceDays += 3;
        log('–ö—É–ø–ª–µ–Ω–∞ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –Ω–∞ 3 –Ω–æ—á–∏ (-10‚Ç∏)');
        updateCurrencyDisplay();
        saveGame();
        render();
      }
    });

    // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
    loadGame();
    render();
    log('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ CoreBox 2.1!');
    log('–ù–∞–∂–º–∏ "I" –¥–Ω—ë–º —á—Ç–æ–±—ã –∫—É–ø–∏—Ç—å —Å—Ç—Ä–∞—Ö–æ–≤–∫—É (10‚Ç∏)');
  </script>
</body>
</html>